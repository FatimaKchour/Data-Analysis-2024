import pandas as pd

# Load the data from the Excel file
file_path = 'path_to_your_excel_file.xlsx'  # Replace with your file path
df = pd.read_excel(file_path)

# Initialize variables to track the start of the fixations
last_id = None
start_timestamp = None

# Iterate over the dataframe to fill OBJECT_FIXATED and calculate GLANCE_DURATION
for i in range(len(df)):
    current_id = df.at[i, 'ID_GAZE_CLASS']
    current_timestamp = df.at[i, 'TIMESTAMP']
    
    if pd.notna(current_id):
        if current_id == last_id:
            # Continue the fixation
            end_timestamp = current_timestamp
        else:
            # New fixation starts
            if last_id is not None and start_timestamp is not None:
                # Calculate the duration for the previous fixation
                df.loc[start_idx, 'GLANCE_DURATION'] = end_timestamp - start_timestamp
            
            # Start new fixation
            last_id = current_id
            start_timestamp = current_timestamp
            start_idx = i
            end_timestamp = current_timestamp
        
        # Fill OBJECT_FIXATED
        df.at[i, 'OBJECT_FIXATED'] = current_id
    else:
        # End the previous fixation
        if last_id is not None and start_timestamp is not None:
            df.loc[start_idx, 'GLANCE_DURATION'] = end_timestamp - start_timestamp
        
        # Reset variables
        last_id = None
        start_timestamp = None

# Handle the last fixation in the loop
if last_id is not None and start_timestamp is not None:
    df.loc[start_idx, 'GLANCE_DURATION'] = end_timestamp - start_timestamp

# Save the updated DataFrame back to the Excel file
output_file_path = 'path_to_your_output_excel_file.xlsx'  # Replace with your output file path
df.to_excel(output_file_path, index=False)

print("Processing complete. The results have been saved to the output file.")
